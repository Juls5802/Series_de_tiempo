<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Análisis de series de tiempo - 3&nbsp; Ajuste de modelos para serie de Energía</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Descriptivo Energia.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Entrega 2 bonito.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Ajuste de modelos para serie de Energía</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Análisis de series de tiempo</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introducción</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Descriptivo Dian (2).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Análisis descriptivo del recaudo de impuestos internos por la DIAN</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Descriptivo Energia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Análisis del consumo de energía de la empresa PJM</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Entrega 2 bonito.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Ajuste de modelos para serie de Energía</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#suavizamiento-exponencial" id="toc-suavizamiento-exponencial" class="nav-link active" data-scroll-target="#suavizamiento-exponencial"><span class="header-section-number">3.1</span> Suavizamiento Exponencial</a></li>
  <li><a href="#proceso-arma" id="toc-proceso-arma" class="nav-link" data-scroll-target="#proceso-arma"><span class="header-section-number">3.2</span> Proceso ARMA</a></li>
  <li><a href="#proceso-arima" id="toc-proceso-arima" class="nav-link" data-scroll-target="#proceso-arima"><span class="header-section-number">3.3</span> Proceso ARIMA</a></li>
  <li><a href="#proceso-sarima" id="toc-proceso-sarima" class="nav-link" data-scroll-target="#proceso-sarima"><span class="header-section-number">3.4</span> Proceso SARIMA</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Ajuste de modelos para serie de Energía</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Como vimos en la sección anterior. Para la serie de energía no fue necesario estabilizar la varianza, sin embargo, esta presenta tanto tendencia como multiple estacionalidad (<span class="math inline">\(7\)</span> y <span class="math inline">\(365.25\)</span>)</p>
<p>Una vez realizado el análisis descriptivo de la serie de energía, se da inicio al modelamiento de la misma. Este se hará por medio de 3 modelos:</p>
<ul>
<li>Suavizamiento exponencial</li>
<li>Modelo ARMA con series de Fourier</li>
</ul>
<p>Estos modelos serán contrastados con base en su capacidad predictiva para seleccionar el mejor y realizar prediciones con él acerca del consumo diario de energia de la empresa PJM para fechas poseriores al año 2018.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Librerías necesarias</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TSstudio)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(astsa)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(feasts)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fable)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timetk)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nonlinearTseries)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseriesChaos) </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parsnip)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timetk)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modeltime)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(greybox)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TSA)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urca)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(uroot)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fUnitRoots)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sarima)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TSA)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">"PolynomF"</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">"forecast"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="suavizamiento-exponencial" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="suavizamiento-exponencial"><span class="header-section-number">3.1</span> Suavizamiento Exponencial</h2>
<section id="carga-de-la-base-de-datos" class="level5" data-number="3.1.0.0.1">
<h5 data-number="3.1.0.0.1" class="anchored" data-anchor-id="carga-de-la-base-de-datos"><span class="header-section-number">3.1.0.0.1</span> Carga de la base de datos</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Carga de la base de datos</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>AEP_hourly<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"AEP_hourly.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>AEP_hourly<span class="sc">$</span>Datetime<span class="ot">&lt;-</span><span class="fu">as.POSIXct</span>(AEP_hourly<span class="sc">$</span>Datetime, <span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>AEP_hourly<span class="sc">$</span>fecha<span class="ot">&lt;-</span><span class="fu">as.Date</span>(AEP_hourly<span class="sc">$</span>Datetime)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>energia <span class="ot">&lt;-</span> AEP_hourly <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fecha) <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Energia =</span> <span class="fu">sum</span>(AEP_MW))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>energia<span class="ot">&lt;-</span>energia[<span class="sc">-</span><span class="dv">5055</span>,]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>energia2<span class="ot">&lt;-</span><span class="fu">ts</span>(energia<span class="sc">$</span>Energia,<span class="at">start=</span><span class="fu">c</span>(<span class="dv">2004</span>,<span class="dv">10</span>,<span class="dv">01</span>),<span class="at">frequency=</span><span class="fl">365.25</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación del objeto msts indicando las dos estacionalidades</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ly <span class="ot">&lt;-</span> <span class="fu">msts</span>(energia<span class="sc">$</span>Energia,<span class="at">start=</span><span class="fu">c</span>(<span class="dv">2004</span>,<span class="dv">10</span>,<span class="dv">01</span>), <span class="at">seasonal.periods=</span><span class="fu">c</span>(<span class="dv">7</span>,<span class="fl">365.25</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#HW_ly=stats::HoltWinters(ly,seasonal="additive") # parece que sí funciona</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicciones</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#forecast::forecast(HW_ly,h=7,level =0.95)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(forecast::forecast(HW_ly,h=7,level =0.95))</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="separación-datos-de-entrenamiento-y-prueba" class="level4" data-number="3.1.0.1">
<h4 data-number="3.1.0.1" class="anchored" data-anchor-id="separación-datos-de-entrenamiento-y-prueba"><span class="header-section-number">3.1.0.1</span> Separación datos de entrenamiento y prueba</h4>
<p>Se hizo una división de los datos originales, el <span class="math inline">\(85\%\)</span> para datos de entrenamiento y el <span class="math inline">\(15\%\)</span> restante para datoos de prueba.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separar train y test</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>h<span class="ot">=</span><span class="dv">1</span> <span class="co"># Haremos predicciones 1-paso hacia delante</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos entrenamiento</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>ntrain<span class="ot">=</span><span class="fu">trunc</span>(<span class="fu">length</span>(ly)<span class="sc">*</span><span class="fl">0.85</span>) <span class="co"># 4295 datos</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>train<span class="ot">=</span><span class="fu">window</span>(ly,<span class="at">end=</span><span class="fu">time</span>(ly)[ntrain])</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos prueba</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>test<span class="ot">=</span><span class="fu">window</span>(ly,<span class="at">start=</span><span class="fu">time</span>(ly)[ntrain]<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>ntest<span class="ot">=</span><span class="fu">length</span>(test) <span class="co"># 729 datos</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># fchstepahe: Vector para guardar las predicciones h-pasos adelante</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>fchstepahe<span class="ot">=</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span>ntest,<span class="at">ncol=</span>h) </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># verval: Vector con los verdaderos valores de la serie en el conjunto de prueba con los que se compararán los pronósticos</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>verval<span class="ot">=</span>test[<span class="dv">1</span><span class="sc">:</span>ntest]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ajuste-del-modelo" class="level4" data-number="3.1.0.2">
<h4 data-number="3.1.0.2" class="anchored" data-anchor-id="ajuste-del-modelo"><span class="header-section-number">3.1.0.2</span> Ajuste del modelo</h4>
<p>En el modelo por medio de suavizamiento exponencial también se considera una descomposición de la serie de forma aditiva. Las componentes de tenendecia y la estacionalidad se estiman por medio de una estadística EWMA (promedio movil ponderado exponencialmente), dándole más peso a las observaciones más cercanas en cada tiempo.</p>
<p>Además, para este caso, se descompone la componente de tendencia en nivel y pendiente, y se estima un parámetro de la componente estacional. Las estimaciones se hallan de la siguiente manera:</p>
<p><span class="math display">\[\begin{align*}
\text{Componente de nivel: } &amp; a_t=α(x_t-S_{t-p})+(1−α)(a_{t−1}+b_{t−1})\\
\text{Componente de pendiente: } &amp; b_t=β(a_t−a_{t−1})+(1−β)b_{t−1} \\
\text{Componente estacional: } &amp; S_t=\gamma(x_t−a_t)+(1−γ)S_{t−p} \\
\end{align*}\]</span></p>
<p>Para encontrar los parámetros de suavizamiento <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\gamma\)</span> usamos una grilla con valores desde <span class="math inline">\(0.001\)</span> hasta <span class="math inline">\(0.999\)</span> de a <span class="math inline">\(0.1\)</span> para cada parámetro.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(utils)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Propuestas para cada parámetro</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>suav_inputs<span class="ot">=</span><span class="fu">cbind</span>(<span class="fu">seq</span>(<span class="fl">0.001</span>,<span class="fl">0.999</span>,<span class="fl">0.1</span>),<span class="fu">seq</span>(<span class="fl">0.001</span>,<span class="fl">0.999</span>,<span class="fl">0.1</span>),<span class="fu">seq</span>(<span class="fl">0.001</span>,<span class="fl">0.999</span>,<span class="fl">0.1</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(suav_inputs)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"alpha"</span>,<span class="st">"beta"</span>,<span class="st">"gamma"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>suav_inputs_tbl<span class="ot">=</span>tibble<span class="sc">::</span><span class="fu">as_tibble</span>(suav_inputs)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación de la grilla</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>grilla_suav<span class="ot">=</span><span class="fu">expand.grid</span>(<span class="at">alpha=</span>suav_inputs_tbl<span class="sc">$</span>alpha,<span class="at">beta=</span>suav_inputs_tbl<span class="sc">$</span>beta,<span class="at">gamma=</span>suav_inputs_tbl<span class="sc">$</span>gamma)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz para almacenar los errores</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>errores<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span><span class="dv">1000</span>,<span class="at">ncol=</span><span class="dv">3</span>) </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Búsqueda de alpha, beta y gamma con rolling, queremos que minimice ECM</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  ourCallETS <span class="ot">&lt;-</span> <span class="st">"forecast::forecast(stats::HoltWinters(x=data,alpha=grilla_suav[i,1],beta=grilla_suav[i,2],gamma=grilla_suav[i,3]),h=h,level=95)"</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  ourValueETS <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mean"</span>,<span class="st">"lower"</span>,<span class="st">"upper"</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  origins<span class="ot">=</span>ntest   <span class="co"># Número de rolling windows</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  Valoresretornados1 <span class="ot">&lt;-</span> <span class="fu">ro</span>(ly, <span class="at">h=</span>h, <span class="at">origins=</span>origins, <span class="at">call=</span>ourCallETS, <span class="at">value=</span>ourValueETS,<span class="at">ci=</span><span class="cn">FALSE</span>,<span class="at">co=</span><span class="cn">FALSE</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>(Valoresretornados1<span class="sc">$</span>holdout) <span class="co"># Permiten verificar los verdaderos valores h-pasos adelante. </span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>(Valoresretornados1<span class="sc">$</span>mean)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  errores[i,]<span class="ot">&lt;-</span><span class="fu">sqrt</span>(<span class="fu">apply</span>((Valoresretornados1<span class="sc">$</span>holdout <span class="sc">-</span>Valoresretornados1<span class="sc">$</span>mean)<span class="sc">^</span><span class="dv">2</span>,<span class="dv">1</span>,mean,<span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="co"># Se calcula la raíz del error cuadrático medio de predicción</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Error medio absoluto escalado</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>errores<span class="ot">&lt;-</span><span class="fu">na.omit</span>(errores) </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(errores[,<span class="dv">1</span>]) <span class="co"># RECM= 47201.82</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(errores[,<span class="dv">1</span>] <span class="sc">==</span> <span class="fu">min</span>(errores[,<span class="dv">1</span>])) <span class="co"># 885</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>grilla_suav[<span class="dv">885</span>,] <span class="co"># alpha=0.701, beta=0.701, gamma=0.501</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 47201.82</code></pre>
</div>
</div>
<p>De modo que el modelo final para suavizamiento exponencial es</p>
<p><span class="math display">\[\begin{align*}
\text{Componente de nivel: } &amp; a_t=0.701(x_t-S_{t-p})+(1−0.701)(a_{t−1}+b_{t−1})\\
\text{Componente de pendiente: } &amp; b_t=0.701(a_t−a_{t−1})+(1−0.701)b_{t−1} \\
\text{Componente estacional: } &amp; S_t=0.7501(x_t−a_t)+(1−0.501)S_{t−p} \\
\end{align*}\]</span></p>
</section>
<section id="evaluar-los-supuestos" class="level4" data-number="3.1.0.3">
<h4 data-number="3.1.0.3" class="anchored" data-anchor-id="evaluar-los-supuestos"><span class="header-section-number">3.1.0.3</span> Evaluar los supuestos</h4>
<p>Aunque en suavizamiento exponencial no se hacen supuestos sobre los residuales, aún así hicimos las pruebas para ver si los residuales tenían un comportamiento similar a ruido blanco.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificación de supuestos</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>HW_train_grilla<span class="ot">=</span>stats<span class="sc">::</span><span class="fu">HoltWinters</span>(train,<span class="at">seasonal=</span><span class="st">"additive"</span>,<span class="at">alpha=</span><span class="fl">0.701</span>,<span class="at">beta=</span><span class="fl">0.701</span>,<span class="at">gamma=</span><span class="fl">0.501</span>) <span class="co"># con los parámetros que dieron mejor en la grilla</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuales</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> ly<span class="sc">-</span>HW_train_grilla<span class="sc">$</span>fitted[,<span class="dv">1</span>]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(res)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="no-autocorrelación" class="level6" data-number="3.1.0.3.0.1">
<h6 data-number="3.1.0.3.0.1" class="anchored" data-anchor-id="no-autocorrelación"><span class="header-section-number">3.1.0.3.0.1</span> No autocorrelación</h6>
<p>Luego de ser modelados con el suavizamiento exponencial, parece que aún queda correlación por explicar</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">as.numeric</span>(res)) <span class="co"># No deberían estar fuera de las bandas</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#acf(res^2)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="no-autocorrelación-parcial" class="level6" data-number="3.1.0.3.0.2">
<h6 data-number="3.1.0.3.0.2" class="anchored" data-anchor-id="no-autocorrelación-parcial"><span class="header-section-number">3.1.0.3.0.2</span> No autocorrelación parcial</h6>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PACF</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(<span class="fu">as.numeric</span>(res)) <span class="co"># No deberían estar fuera de las bandas</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="test-de-normalidad" class="level6" data-number="3.1.0.3.0.3">
<h6 data-number="3.1.0.3.0.3" class="anchored" data-anchor-id="test-de-normalidad"><span class="header-section-number">3.1.0.3.0.3</span> Test de normalidad</h6>
<p>Parece que no hay normalidad en los residuales</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de normalidad</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">## NO queremos rechazar H0 pero pues no es tan grave</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">jarque.bera.test</span>(res) <span class="co"># Dice que no son normales</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Jarque Bera Test

data:  res
X-squared = 49.017, df = 2, p-value = 2.27e-11</code></pre>
</div>
</div>
</section>
<section id="test-de-autocorrelación" class="level6" data-number="3.1.0.3.0.4">
<h6 data-number="3.1.0.3.0.4" class="anchored" data-anchor-id="test-de-autocorrelación"><span class="header-section-number">3.1.0.3.0.4</span> Test de autocorrelación</h6>
<p>Luego de ser modelados con el suavizamiento exponencial, parece que los residuales están correlacionados</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de autocorrelacion </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="do">## No quieremos rechazar H0</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(res, <span class="at">lag =</span><span class="dv">20</span> , <span class="at">type =</span> <span class="st">"Ljung-Box"</span>, <span class="at">fitdf =</span> <span class="dv">2</span>) <span class="co"># No puedo Rechazar la hipótesis de no autocorrelación!</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Box-Ljung test

data:  res
X-squared = 6590.4, df = 18, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="estabilización-de-la-varianza" class="level6" data-number="3.1.0.3.0.5">
<h6 data-number="3.1.0.3.0.5" class="anchored" data-anchor-id="estabilización-de-la-varianza"><span class="header-section-number">3.1.0.3.0.5</span> Estabilización de la varianza</h6>
<p>CREO QUE ESTO ES MEJOR NO PONERLO PQ NO SÉ SI SIRVA PARA SUAVIZAMIENTO</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estadisticas CUSUM</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Mide la estabilidad en los parámetros del modelo</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>cum<span class="ot">=</span><span class="fu">cumsum</span>(res)<span class="sc">/</span><span class="fu">sd</span>(res)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>N<span class="ot">=</span><span class="fu">length</span>(res)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>cumq<span class="ot">=</span><span class="fu">cumsum</span>(res<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(res<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>Af<span class="ot">=</span><span class="fl">0.948</span> <span class="do">###Cuantil del 95% para la estad?stica cusum</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>co<span class="ot">=</span><span class="fl">0.01717</span><span class="do">####Valor del cuantil aproximado para cusumsq para n/2</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>LS<span class="ot">=</span>Af<span class="sc">*</span><span class="fu">sqrt</span>(N)<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>Af<span class="sc">*</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res))<span class="sc">/</span><span class="fu">sqrt</span>(N)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>LI<span class="ot">=</span><span class="sc">-</span>LS</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>LQS<span class="ot">=</span>co<span class="sc">+</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res))<span class="sc">/</span>N</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>LQI<span class="ot">=</span><span class="sc">-</span>co<span class="sc">+</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res))<span class="sc">/</span>N</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cum,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(LI),<span class="fu">max</span>(LS)),<span class="at">xlab=</span><span class="st">"t"</span>,<span class="at">ylab=</span><span class="st">""</span>,<span class="at">main=</span><span class="st">"CUSUM"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(LS,<span class="at">type=</span><span class="st">"S"</span>,<span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(LI,<span class="at">type=</span><span class="st">"S"</span>,<span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estadísticas CUSUMSQ</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Mide la estabilidad en la varianza del modelo</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cumq,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"t"</span>,<span class="at">ylab=</span><span class="st">""</span>,<span class="at">main=</span><span class="st">"CUSUMSQ"</span>)                      </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(LQS,<span class="at">type=</span><span class="st">"S"</span>,<span class="at">col=</span><span class="st">"red"</span>)                                           </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(LQI,<span class="at">type=</span><span class="st">"S"</span>,<span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="predicciones-sobre-datos-de-prueba" class="level4" data-number="3.1.0.4">
<h4 data-number="3.1.0.4" class="anchored" data-anchor-id="predicciones-sobre-datos-de-prueba"><span class="header-section-number">3.1.0.4</span> Predicciones sobre datos de prueba</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>verval_ts<span class="ot">&lt;-</span><span class="fu">ts</span>(verval,<span class="at">start=</span><span class="fu">time</span>(ly)[ntrain]<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="fl">365.25</span>,<span class="at">frequency=</span><span class="fl">365.25</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fchstepahe_ts<span class="ot">&lt;-</span><span class="fu">ts</span>(fchstepahe,<span class="at">start=</span><span class="fu">time</span>(ly)[ntrain]<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="fl">365.25</span>,<span class="at">frequency=</span><span class="fl">365.25</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(verval_ts, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">ylab =</span> <span class="st">"Energía"</span>, <span class="at">xlab =</span> <span class="st">"Tiempo"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fchstepahe_ts, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Reales"</span>, <span class="st">"Predicciones"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="proceso-arma" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="proceso-arma"><span class="header-section-number">3.2</span> Proceso ARMA</h2>
<section id="carga-de-la-base-de-datos-1" class="level4" data-number="3.2.0.1">
<h4 data-number="3.2.0.1" class="anchored" data-anchor-id="carga-de-la-base-de-datos-1"><span class="header-section-number">3.2.0.1</span> Carga de la base de datos</h4>
<p>Para ajustar un modelo de la familia <em>ARMA(p,q)</em> es necesario que los datos sean estacionarios, por lo tanto, usamos los datos que resultan luego de eliminar la tendencia línealmente y eliminar la doble estacionalidad que fue modelada usando 6 componentes de Fourier (3 para <span class="math inline">\(s=7\)</span> y 3 para <span class="math inline">\(s=182\)</span>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos estacionales</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"energia_estacionarios.RDS"</span>) <span class="co"># datos estacionarios</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">2004</span>,<span class="dv">2006</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Comprobamos que son estacionarios observando la subserie semanal y la subserie mensual</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preliminares</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>est_1<span class="ot">&lt;-</span><span class="fu">cbind</span>(<span class="fu">as.matrix</span>(y),<span class="fu">as.character</span>(energia<span class="sc">$</span>fecha))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>est_1<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(est_1)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(est_1)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Energia"</span>,<span class="st">"fecha"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>est_1<span class="sc">$</span>Energia<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(est_1<span class="sc">$</span>Energia)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>est_1<span class="sc">$</span>fecha<span class="ot">&lt;-</span><span class="fu">as.Date</span>(est_1<span class="sc">$</span>fecha)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>df_est<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">Energia=</span>est_1<span class="sc">$</span>Energia,<span class="at">fecha=</span>est_1<span class="sc">$</span>fecha)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>tbl_est<span class="ot">=</span><span class="fu">tibble</span>(df_est)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>tbl_est_format_fecha<span class="ot">=</span>tbl_est</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>tsbl_est<span class="ot">=</span><span class="fu">as_tsibble</span>(tbl_est_format_fecha,<span class="at">index=</span>fecha)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Subserie semanal</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_subseries</span>(tsbl_est,<span class="at">y=</span>Energia,<span class="at">period=</span><span class="dv">7</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subserie mensual</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_subseries</span>(tsbl_est,<span class="at">y=</span>Energia,<span class="at">period=</span><span class="dv">12</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="búsqueda-de-los-hiperparámetros-p-y-q" class="level4" data-number="3.2.0.2">
<h4 data-number="3.2.0.2" class="anchored" data-anchor-id="búsqueda-de-los-hiperparámetros-p-y-q"><span class="header-section-number">3.2.0.2</span> Búsqueda de los hiperparámetros <em>p</em> y <em>q</em></h4>
<p>La búsqueda de los hiperparámetros <em>p</em> y <em>q</em> se hace vía ACF y PACF</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Búsqueda de p,q vía acf y pacf</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Búsqueda de q</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">as.numeric</span>(y)) <span class="co"># Parece que q es gigante</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#acf(as.numeric(y),ci.type='ma') # En efecto, q es grande</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Búsqueda de p</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(<span class="fu">as.numeric</span>(y)) <span class="co"># p máximo 3, posiblemente 5 o 6</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Luego de observar los gráficos, vemos que es posible que <span class="math inline">\(p=6\)</span> o menos, y <span class="math inline">\(q\)</span> debe ser grandísimo, por razones prácticas postulamos inicialmente <span class="math inline">\(q=20\)</span>, es razonable postular un modelo <em>AR(6)</em> y refinarlo, así como también un modelo mixto <em>ARMA(6,20)</em> y refinarlo. No es nada razonable pensar en un <span class="math inline">\(MA(q)\)</span> puro por lo que vemos que el ACF decae excesivamente lento.</p>
</section>
<section id="ajuste-del-modelo-arma" class="level4" data-number="3.2.0.3">
<h4 data-number="3.2.0.3" class="anchored" data-anchor-id="ajuste-del-modelo-arma"><span class="header-section-number">3.2.0.3</span> Ajuste del modelo ARMA</h4>
<p>Inicialmente se ajustó un modelo <em>AR(6)</em> y se refinó, sin embargo no se encontró un modelo autoregresivo puro que cumpliera los supuestos. Luego de una ardua búsqueda, finalmente encontramos un modelo mixto que cumpliera los supuestos, este es <em>ARMA(5,8)</em> que también fue refinado, de modo que el modelo final es:</p>
<p><span class="math display">\[X_t=\phi_1 X_{t-1}+\phi_2 X_{t-2}+\phi_3 X_{t-3}+Z_t+\theta_1 Z_{t-1}+\theta_2 Z_{t-2}+\theta_3 Z_{t-3}+\theta_4 Z_{t-4}+\theta_6 Z_{t-6}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Propuesta modelo ARMA</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>modelo.propuesto2<span class="ot">=</span>forecast<span class="sc">::</span><span class="fu">Arima</span>(y,<span class="at">order=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">8</span>),<span class="at">fixed=</span><span class="fu">c</span>(<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="dv">0</span>,<span class="cn">NA</span>,<span class="dv">0</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="dv">0</span>,<span class="cn">NA</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)) <span class="co"># ARMA(5,8)</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">coeftest</span>(modelo.propuesto2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
z test of coefficients:

     Estimate Std. Error  z value  Pr(&gt;|z|)    
ar1  0.278287   0.116425   2.3903   0.01684 *  
ar2  1.017041   0.143894   7.0680 1.572e-12 ***
ar4 -0.312920   0.034978  -8.9463 &lt; 2.2e-16 ***
ma1  0.819146   0.116858   7.0098 2.387e-12 ***
ma2 -0.567652   0.028526 -19.8992 &lt; 2.2e-16 ***
ma3 -0.828137   0.071508 -11.5811 &lt; 2.2e-16 ***
ma4 -0.244673   0.027497  -8.8982 &lt; 2.2e-16 ***
ma6  0.026696   0.011651   2.2913   0.02194 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="evaluar-los-supuestos-1" class="level4" data-number="3.2.0.4">
<h4 data-number="3.2.0.4" class="anchored" data-anchor-id="evaluar-los-supuestos-1"><span class="header-section-number">3.2.0.4</span> Evaluar los supuestos</h4>
<p>Para los modelos de la familia <em>ARMA</em> sí se hacen supuestos sobre los residuales que deben comportarse como ruido blanco. Por lo tanto, es necesario validar los supuestos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificación de supuestos ARMA</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> modelo.propuesto2<span class="sc">$</span>residuals</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(res)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="no-autocorrelación-1" class="level6" data-number="3.2.0.4.0.1">
<h6 data-number="3.2.0.4.0.1" class="anchored" data-anchor-id="no-autocorrelación-1"><span class="header-section-number">3.2.0.4.0.1</span> No autocorrelación</h6>
<p>En general, los residuales presentan un buen comportamiento. No qued nada por explicar que no haya explicado ya el modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">as.numeric</span>(res)) <span class="co"># No deberían estar fuera de las bandas</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># acf(as.numeric(res^2))</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="no-autocorrelación-parcial-1" class="level6" data-number="3.2.0.4.0.2">
<h6 data-number="3.2.0.4.0.2" class="anchored" data-anchor-id="no-autocorrelación-parcial-1"><span class="header-section-number">3.2.0.4.0.2</span> No autocorrelación parcial</h6>
<p>En general, los residuales presentan un buen comportamiento. No qued nada por explicar que no haya explicado ya el modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PACF</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(<span class="fu">as.numeric</span>(res)) <span class="co"># No deberían estar fuera de las bandas</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="test-de-normalidad-1" class="level5" data-number="3.2.0.4.1">
<h5 data-number="3.2.0.4.1" class="anchored" data-anchor-id="test-de-normalidad-1"><span class="header-section-number">3.2.0.4.1</span> Test de normalidad</h5>
<p>Parece ser que los datos NO son normales.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Test de normalidad </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="do">## No queremos rechazar H0 pero pues no es tan grave</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">jarque.bera.test</span>(res)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Jarque Bera Test

data:  res
X-squared = 2096.9, df = 2, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="test-de-autocorrelación-1" class="level5" data-number="3.2.0.4.2">
<h5 data-number="3.2.0.4.2" class="anchored" data-anchor-id="test-de-autocorrelación-1"><span class="header-section-number">3.2.0.4.2</span> Test de autocorrelación</h5>
<p>Con un <span class="math inline">\(p-value=\)</span> no hay suficiente evidencia estadística para rechazar la hipóstesis nula, es decir, los residuales NO están correlacionados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Test de autocorrelacion </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="do">## No queremos rechazar H0 pq es la hipótesis de no autocorrelación</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(res, <span class="at">lag =</span><span class="dv">20</span> , <span class="at">type =</span> <span class="st">"Ljung-Box"</span>, <span class="at">fitdf =</span> <span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Box-Ljung test

data:  res
X-squared = 19.468, df = 18, p-value = 0.3636</code></pre>
</div>
</div>
</section>
<section id="estabilización-de-la-varianza-1" class="level5" data-number="3.2.0.4.3">
<h5 data-number="3.2.0.4.3" class="anchored" data-anchor-id="estabilización-de-la-varianza-1"><span class="header-section-number">3.2.0.4.3</span> Estabilización de la varianza</h5>
<p>Parece que tanto los parámetros como la varianza están “estables”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estadisticas CUSUM</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Mide la estabilidad en los parámetros del modelo</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>cum<span class="ot">=</span><span class="fu">cumsum</span>(res)<span class="sc">/</span><span class="fu">sd</span>(res)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>N<span class="ot">=</span><span class="fu">length</span>(res)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>cumq<span class="ot">=</span><span class="fu">cumsum</span>(res<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(res<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>Af<span class="ot">=</span><span class="fl">0.948</span> <span class="do">###Cuantil del 95% para la estad?stica cusum</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>co<span class="ot">=</span><span class="fl">0.01717</span><span class="do">####Valor del cuantil aproximado para cusumsq para n/2</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>LS<span class="ot">=</span>Af<span class="sc">*</span><span class="fu">sqrt</span>(N)<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>Af<span class="sc">*</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res))<span class="sc">/</span><span class="fu">sqrt</span>(N)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>LI<span class="ot">=</span><span class="sc">-</span>LS</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>LQS<span class="ot">=</span>co<span class="sc">+</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res))<span class="sc">/</span>N</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>LQI<span class="ot">=</span><span class="sc">-</span>co<span class="sc">+</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res))<span class="sc">/</span>N</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cum,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(LI),<span class="fu">max</span>(LS)),<span class="at">xlab=</span><span class="st">"t"</span>,<span class="at">ylab=</span><span class="st">""</span>,<span class="at">main=</span><span class="st">"CUSUM"</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(LS,<span class="at">type=</span><span class="st">"S"</span>,<span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(LI,<span class="at">type=</span><span class="st">"S"</span>,<span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estadísticas CUSUMSQ</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Mide la estabilidad en la varianza del modelo</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cumq,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"t"</span>,<span class="at">ylab=</span><span class="st">""</span>,<span class="at">main=</span><span class="st">"CUSUMSQ"</span>)                      </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(LQS,<span class="at">type=</span><span class="st">"S"</span>,<span class="at">col=</span><span class="st">"red"</span>)                                           </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(LQI,<span class="at">type=</span><span class="st">"S"</span>,<span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="rolling" class="level5" data-number="3.2.0.4.4">
<h5 data-number="3.2.0.4.4" class="anchored" data-anchor-id="rolling"><span class="header-section-number">3.2.0.4.4</span> Rolling</h5>
<p>Una vez verificados los supuestos, se procede a evaluar la capacidad predictiva del modelo mixto. Para ello utilizamos rolling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rolling corregido</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>fcmat<span class="ot">=</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span>ntest,<span class="at">ncol=</span>h)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ntest){</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  x<span class="ot">=</span><span class="fu">window</span>(y,<span class="at">end=</span><span class="fu">time</span>(ly)[ntrain]<span class="sc">+</span>(i<span class="dv">-1</span>)<span class="sc">/</span><span class="fl">365.25</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  refit<span class="ot">=</span><span class="fu">Arima</span>(x,<span class="at">model=</span>modelo.propuesto2)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  fcmat[i,]<span class="ot">=</span><span class="fu">as.numeric</span>(forecast<span class="sc">::</span><span class="fu">forecast</span>(refit,<span class="at">h=</span>h)<span class="sc">$</span>mean) <span class="co"># Pronósticos para datos estacionarios</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para volver a la escala original</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>estacionalidad<span class="ot">&lt;-</span><span class="fu">as.vector</span>(results_ciclo_ts)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>tendencia<span class="ot">&lt;-</span><span class="fu">as.vector</span>(<span class="fu">predict</span>(fit_e))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>fchstepahe<span class="ot">&lt;-</span>(fcmat<span class="sc">+</span>estacionalidad[<span class="dv">4296</span><span class="sc">:</span><span class="dv">5054</span>])<span class="sc">+</span>tendencia[<span class="dv">4296</span><span class="sc">:</span><span class="dv">5054</span>] <span class="co"># primero sumamos la estacionalidad y luego la tendencia</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>errores_pred <span class="ot">=</span> verval<span class="sc">-</span>fchstepahe </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>ECM<span class="ot">=</span><span class="fu">apply</span>(errores_pred<span class="sc">^</span><span class="dv">2</span>,<span class="at">MARGIN =</span> <span class="dv">2</span>,mean,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>RECM<span class="ot">=</span><span class="fu">sqrt</span>(ECM)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>RECM <span class="co"># 22840.1</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22840.1</code></pre>
</div>
</div>
</section>
</section>
<section id="predicciones-sobre-datos-de-prueba-1" class="level4" data-number="3.2.0.5">
<h4 data-number="3.2.0.5" class="anchored" data-anchor-id="predicciones-sobre-datos-de-prueba-1"><span class="header-section-number">3.2.0.5</span> Predicciones sobre datos de prueba</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fchstepahe_ts<span class="ot">&lt;-</span><span class="fu">ts</span>(fchstepahe,<span class="at">start=</span><span class="fu">time</span>(ly)[ntrain]<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="fl">365.25</span>,<span class="at">frequency=</span><span class="fl">365.25</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(verval_ts, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">ylab =</span> <span class="st">"Energía"</span>, <span class="at">xlab =</span> <span class="st">"Tiempo"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fchstepahe_ts, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Reales"</span>, <span class="st">"Predicciones"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Entrega-2-bonito_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="proceso-arima" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="proceso-arima"><span class="header-section-number">3.3</span> Proceso ARIMA</h2>
<p>Para ajustar un modelo ARIMA (aunque no es lo más adecuado dado que la serie presenta componente estacional), primero se debe comprobar si la serie de tiempo presenta una raíz unitaria. Teniendo en cuenta que, para la prueba de Dicker Fuller, si el <span class="math inline">\(p-valor\)</span> es menor que un nivel de significancia <span class="math inline">\(\alpha\)</span> se rechaza la hipotesis nula de que la serie de tiempo presenta una raíz unitaria, se tiene lo siguiente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">ar</span>(energia2) <span class="co"># Selecciona un modelo AR usando el criterio de Akaike, sugiere tomar lags=36</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
stats::ar(x = energia2)

Coefficients:
      1        2        3        4        5        6        7        8  
 1.0967  -0.4319   0.1631  -0.0202   0.0112   0.0217   0.1385  -0.1334  
      9       10       11       12       13       14       15       16  
 0.0302   0.0394  -0.0436  -0.0045   0.0394   0.1196  -0.1604   0.0593  
     17       18       19       20       21       22       23       24  
 0.0172  -0.0279   0.0320  -0.0221   0.1656  -0.1895   0.0736  -0.0536  
     25       26       27       28       29       30       31       32  
 0.0436  -0.0453   0.0435   0.1166  -0.1403   0.0378  -0.0228  -0.0066  
     33       34       35       36  
-0.0332   0.0232   0.1493  -0.1453  

Order selected 36  sigma^2 estimated as  329070266</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">adf.test</span>(energia2,<span class="at">k=</span><span class="dv">36</span>) <span class="co"># Prueba Dicker Fuller: No hay raíz unitaria</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tseries::adf.test(energia2, k = 36): p-value smaller than printed
p-value</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  energia2
Dickey-Fuller = -8.1586, Lag order = 36, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">ur.df</span>(energia2,<span class="at">type=</span><span class="st">"trend"</span>,<span class="at">lags =</span> <span class="dv">36</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
############################################### 
# Augmented Dickey-Fuller Test Unit Root Test # 
############################################### 

Test regression trend 


Call:
lm(formula = z.diff ~ z.lag.1 + 1 + tt + z.diff.lag)

Residuals:
    Min      1Q  Median      3Q     Max 
-144842  -10683    -880   10058   98316 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   2.648e+04  3.278e+03   8.079 8.14e-16 ***
z.lag.1      -6.722e-02  8.239e-03  -8.159 4.25e-16 ***
tt           -5.746e-01  1.879e-01  -3.058 0.002240 ** 
z.diff.lag1   1.757e-01  1.554e-02  11.307  &lt; 2e-16 ***
z.diff.lag2  -2.754e-01  1.569e-02 -17.549  &lt; 2e-16 ***
z.diff.lag3  -9.995e-02  1.614e-02  -6.193 6.37e-10 ***
z.diff.lag4  -1.297e-01  1.614e-02  -8.032 1.18e-15 ***
z.diff.lag5  -1.096e-01  1.623e-02  -6.755 1.59e-11 ***
z.diff.lag6  -9.557e-02  1.628e-02  -5.869 4.66e-09 ***
z.diff.lag7   4.296e-02  1.633e-02   2.630 0.008558 ** 
z.diff.lag8  -8.916e-02  1.632e-02  -5.463 4.90e-08 ***
z.diff.lag9  -5.914e-02  1.633e-02  -3.621 0.000297 ***
z.diff.lag10 -1.984e-02  1.634e-02  -1.214 0.224918    
z.diff.lag11 -6.555e-02  1.630e-02  -4.022 5.86e-05 ***
z.diff.lag12 -6.658e-02  1.631e-02  -4.081 4.55e-05 ***
z.diff.lag13 -2.957e-02  1.630e-02  -1.814 0.069749 .  
z.diff.lag14  8.892e-02  1.630e-02   5.455 5.13e-08 ***
z.diff.lag15 -7.011e-02  1.628e-02  -4.306 1.69e-05 ***
z.diff.lag16 -1.172e-02  1.627e-02  -0.720 0.471424    
z.diff.lag17  8.099e-03  1.623e-02   0.499 0.617737    
z.diff.lag18 -2.567e-02  1.621e-02  -1.584 0.113336    
z.diff.lag19  1.229e-02  1.616e-02   0.760 0.447063    
z.diff.lag20 -1.552e-02  1.614e-02  -0.961 0.336397    
z.diff.lag21  1.543e-01  1.610e-02   9.584  &lt; 2e-16 ***
z.diff.lag22 -4.081e-02  1.614e-02  -2.529 0.011471 *  
z.diff.lag23  3.898e-02  1.614e-02   2.415 0.015773 *  
z.diff.lag24 -1.987e-02  1.609e-02  -1.235 0.217069    
z.diff.lag25  2.709e-02  1.598e-02   1.695 0.090117 .  
z.diff.lag26 -2.176e-02  1.588e-02  -1.371 0.170571    
z.diff.lag27  2.413e-02  1.584e-02   1.524 0.127655    
z.diff.lag28  1.405e-01  1.574e-02   8.923  &lt; 2e-16 ***
z.diff.lag29 -5.265e-04  1.572e-02  -0.034 0.973277    
z.diff.lag30  3.564e-02  1.571e-02   2.268 0.023358 *  
z.diff.lag31  1.438e-02  1.555e-02   0.925 0.355066    
z.diff.lag32  6.620e-03  1.535e-02   0.431 0.666276    
z.diff.lag33 -2.859e-02  1.510e-02  -1.894 0.058303 .  
z.diff.lag34 -4.864e-03  1.491e-02  -0.326 0.744260    
z.diff.lag35  1.495e-01  1.411e-02  10.598  &lt; 2e-16 ***
z.diff.lag36 -8.638e-03  1.415e-02  -0.610 0.541638    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17980 on 4978 degrees of freedom
Multiple R-squared:  0.5122,    Adjusted R-squared:  0.5084 
F-statistic: 137.5 on 38 and 4978 DF,  p-value: &lt; 2.2e-16


Value of test-statistic is: -8.1586 22.1938 33.2897 

Critical values for test statistics: 
      1pct  5pct 10pct
tau3 -3.96 -3.41 -3.12
phi2  6.09  4.68  4.03
phi3  8.27  6.25  5.34</code></pre>
</div>
</div>
<p>Como se puede ver, en ambos casos las pruebas muestran que la serie no presenta raíces unitarias, por lo que ajustar este modelo no es adecuado.</p>
</section>
<section id="proceso-sarima" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="proceso-sarima"><span class="header-section-number">3.4</span> Proceso SARIMA</h2>
<p>Dado que la serie presenta multiple estacionalidad, no es posible ajustar un modelo de la familia SARIMA.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Descriptivo Energia.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Análisis del consumo de energía de la empresa PJM</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>