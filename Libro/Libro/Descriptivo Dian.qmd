# Análisis descriptivo del recaudo de impuestos internos por la DIAN

Según lo observado en la serie de tiempo, visualmente se tiene:

* **Heterocedasticidad marginal:** Se puede observar que la varianza de cada instante en la serie no es la misma, a medida que pasa el tiempo esta va aumentanto, por lo tanto surge la necesidad de realizar una transformación Box-cox.
* **Tendencia:** A simple vista se observa que, a medida que pasa el tiempo, la serie oscila al rededor de valores cada vez más grandes, por lo tanto, es necesario estimar la tendencia y posteriormente eliminarla para poder continuar con el análisis de la serie.
* **Componente estacional:** e observan algunos patrones que se repiten con cierta periodicidad (posiblemente cada año), lo cual hace que sea necesario estimar posibles comportamientos estacionales.

## Estabilización de la varianza marginal

Como se observa en la gráfica de la serie de tiempo es necesario realizar una estabilización de la varianza para continuar con el análisis descriptivo,  para esto se utilizó una transformación de Box-cox.

``` {r}
#| warning: false
#| echo: false
library(TSstudio)
library(readxl)
library(dplyr)
library(lubridate)
library(astsa)
library(feasts)
library(fable)
library(timetk)
library(tsibble)
library(zoo)
library(xts)
library(readxl)
library(tidyverse)
library(forecast)
library(plotly)


#### Base de datos de la DIAN #####
dian<-read_excel("dian.xlsx", range="A7:C313", sheet = "Rec mensual a junio 2023" )
años<-2000:2023
dian<-dplyr::filter(dian,Año %in% años)
colnames(dian)<-c("Año","Mes","Impuestos")
dian$fecha<-as.Date(paste(dian$Año, dian$Mes, "1", sep = "-"), format = "%Y-%B-%d")
dian<-dian[,3:4]

## Serie de tiempo de la DIAN ##
dian2<-ts(dian$Impuestos,start=c(2000,01),frequency=12)

#### Base de datos de energia ####
AEP_hourly<-read.csv("AEP_hourly.csv")
AEP_hourly$Datetime<-as.POSIXct(AEP_hourly$Datetime, format = "%Y-%m-%d %H:%M:%S")
AEP_hourly$fecha<-as.Date(AEP_hourly$Datetime)

energia <- AEP_hourly %>%
  group_by(fecha) %>%
  summarise(Energia = sum(AEP_MW))
energia<-energia[-5055,]

## Serie de tiempo de la energia ##
energia2<-ts(energia$Energia,start=c(2004,10,01),frequency=365.25)
```


``` {r}
MASS::boxcox(lm(dian2 ~ 1),seq(-5, 5, length = 50)) ##Notese que no captura al 1
forecast::BoxCox.lambda(dian2, method ="loglik",
                        lower = -1, upper = 3)#Entrega el valor de lambda (0.1), cercano a cero o sea que vale la pena pensar en una transformación logaritmica.
plot(forecast::BoxCox(dian2,lambda=0.1))
```